<div class="container mt-4">
  <h2 class="text-center mb-4">Gestión de Promociones</h2>

  <div class="row">
    <!-- Formulario -->
    <div class="col-lg-5">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Crear / editar promoción</h5>
        </div>

        <div class="card-body">
          <form (ngSubmit)="agregar()" #promoForm="ngForm">
            <!-- Nombre -->
            <div class="mb-3">
              <label for="nombrePromo" class="form-label">Nombre de la promoción</label>
              <input
                id="nombrePromo"
                name="nombrePromo"
                type="text"
                class="form-control"
                [(ngModel)]="nombre"
                required
                placeholder="Ej: Promo verano, 2x1, etc."
              />
            </div>

            <!-- Tipo -->
            <div class="mb-3">
              <label for="tipoPromo" class="form-label">Tipo</label>
              <select
                id="tipoPromo"
                name="tipoPromo"
                class="form-select"
                [(ngModel)]="tipo"
                required
              >
                <option value="porcentaje">Porcentaje (%)</option>
                <option value="fijo">Monto fijo ($ CLP)</option>
              </select>
            </div>

            <!-- Valor -->
            <div class="mb-3">
              <label for="valorPromo" class="form-label">
                Valor
                <span class="text-muted" *ngIf="tipo === 'porcentaje'">
                  (porcentaje de descuento)
                </span>
                <span class="text-muted" *ngIf="tipo === 'fijo'">
                  (monto en pesos)
                </span>
              </label>
              <input
                id="valorPromo"
                name="valorPromo"
                type="number"
                class="form-control"
                [(ngModel)]="valor"
                min="0"
                required
                placeholder="Ej: 10, 25, 5000..."
              />
            </div>

            <!-- Fechas -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="desde" class="form-label">Desde</label>
                <input
                  id="desde"
                  name="desde"
                  type="date"
                  class="form-control"
                  [(ngModel)]="desde"
                  required
                />
              </div>
              <div class="col-md-6 mb-3">
                <label for="hasta" class="form-label">Hasta</label>
                <input
                  id="hasta"
                  name="hasta"
                  type="date"
                  class="form-control"
                  [(ngModel)]="hasta"
                  required
                />
              </div>
            </div>

            <!-- Botones -->
            <div class="d-flex justify-content-end gap-2">
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="limpiar()"
              >
                Limpiar
              </button>
              <button
                type="submit"
                class="btn btn-success"
                [disabled]="!promoForm.form.valid"
              >
                <i class="bi bi-check-circle me-1"></i>
                Guardar promoción
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Tabla de promociones -->
    <div class="col-lg-7">
      <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Promociones registradas</h5>
          <span class="badge bg-secondary">
            {{ promociones?.length || 0 }} en total
          </span>
        </div>

        <div class="card-body p-0">
          <!-- Sin promociones -->
          <div
            *ngIf="!promociones || promociones.length === 0"
            class="p-3 text-center text-muted"
          >
            No hay promociones registradas.
          </div>

          <!-- Tabla -->
          <div
            *ngIf="promociones && promociones.length > 0"
            class="table-responsive"
          >
            <table class="table table-striped table-hover mb-0 align-middle">
              <thead class="table-light">
                <tr>
                  <th>Nombre</th>
                  <th>Tipo</th>
                  <th>Valor</th>
                  <th>Vigencia</th>
                  <th class="text-end">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let p of promociones">
                  <td>{{ p.nombre }}</td>

                  <td>
                    <span
                      class="badge"
                      [ngClass]="
                        p.tipo === 'porcentaje' ? 'bg-info text-dark' : 'bg-warning text-dark'
                      "
                    >
                      {{ p.tipo === 'porcentaje' ? 'Porcentaje' : 'Monto fijo' }}
                    </span>
                  </td>

                  <td>
                    <ng-container *ngIf="p.tipo === 'porcentaje'; else valorFijo">
                      {{ p.valor }}%
                    </ng-container>
                    <ng-template #valorFijo>
                      {{ p.valor | currency: 'CLP':'symbol-narrow' }}
                    </ng-template>
                  </td>

                  <td>
                    {{ p.desde | date: 'dd/MM/yyyy' }} –
                    {{ p.hasta | date: 'dd/MM/yyyy' }}
                  </td>

                  <td class="text-end">
                    <button
                      type="button"
                      class="btn btn-sm btn-outline-danger"
                      (click)="eliminar(p.id)"
                    >
                      <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
